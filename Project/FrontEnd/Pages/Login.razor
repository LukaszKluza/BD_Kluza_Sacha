@page "/login"
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime

<h3>Login</h3>

@if (ErrorMessage != null)
{
    <p style="color: red;">@ErrorMessage</p>
}

<form @onsubmit="SubmitLogin">
    <label for="email">Email:</label>
    <input type="email" id="email" @bind="LoginModel.Email" required /><br />

    <label for="password">Password:</label>
    <input type="password" id="password" @bind="LoginModel.Password" required /><br />

    <button type="submit">Log in</button>
</form>

@code {
    private LoginModel LoginModel = new LoginModel();
    private string ErrorMessage;

    private async Task SubmitLogin()
    {
        var response = await HttpClient.PostAsJsonAsync("http://localhost:5000/api/Client/login", LoginModel);
        if (response.IsSuccessStatusCode)
        {
            var token = await response.Content.ReadAsStringAsync();
            await JSRuntime.InvokeVoidAsync("localStorage.setItem", "token", token);
            NavigationManager.NavigateTo("/profile");
        }
        else
        {
            ErrorMessage = "Uncorrect email or password.";
        }
    }
}
